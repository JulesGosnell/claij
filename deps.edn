{:paths ["src" "resources"]
 ;; Note: examples in src/claij/examples/ are already on classpath via src/
 :deps {org.clojure/clojure {:mvn/version "1.12.3"}

        ;; M3 validation (legacy - being replaced by Malli)
        org.clojars.jules_gosnell/m3 {:mvn/version "0.1.0-SNAPSHOT"}

        ;; Malli - schema validation (replacing m3)
        metosin/malli {:mvn/version "0.18.0"}

        ;; Database
        com.github.seancorfield/next.jdbc {:mvn/version "1.3.939"}
        org.postgresql/postgresql {:mvn/version "42.7.4"}
        com.zaxxer/HikariCP {:mvn/version "6.2.1"}

        ;; Web server & routing
        ring/ring {:mvn/version "1.14.1"} ; 1.15.0-beta1 is available but using stable
        metosin/reitit {:mvn/version "0.9.1"}
        metosin/reitit-ring {:mvn/version "0.9.1"}

        ;; HTTP client for Claude API
        clj-http/clj-http {:mvn/version "3.13.1"}

        ;; Async processing
        org.clojure/core.async {:mvn/version "1.8.741"}

        ;; JSON handling
        org.clojure/data.json {:mvn/version "2.5.1"}

        ;; Logging
        org.clojure/tools.logging {:mvn/version "1.3.0"}
        org.clojure/tools.cli {:mvn/version "1.2.245"}}

 :aliases
 {:dev {:jvm-opts ["-ea"]
        :extra-paths ["dev" "test"]
        :extra-deps {nrepl/nrepl {:mvn/version "1.5.0"}
                     cider/cider-nrepl {:mvn/version "0.57.0"}
                     refactor-nrepl/refactor-nrepl {:mvn/version "3.11.0"}
                     ring/ring-devel {:mvn/version "1.14.1"}
                     ;; Environment variable management
                     environ/environ {:mvn/version "1.2.0"}
                     io.github.cdimascio/dotenv-java {:mvn/version "3.0.0"}
                     ;; MCP dependencies (only in dev, excluded from production builds)
                     com.bhauman/clojure-mcp {:mvn/version "0.1.6-SNAPSHOT"
                                              :exclusions [org.slf4j/slf4j-nop]}
                     com.taoensso/timbre {:mvn/version "6.8.0"}}
        :main-opts ["-m" "nrepl.cmdline" "--interactive"]}

  ;;:run {:main-opts ["-m" "claij.agent.core"]}
  :run {:main-opts ["-m" "claij.server"]}

  :test {:extra-paths ["test"]
         :extra-deps {lambdaisland/kaocha {:mvn/version "1.91.1392"}
                      lambdaisland/kaocha-cloverage {:mvn/version "1.1.89"}
                      org.testcontainers/testcontainers {:mvn/version "1.21.0"}
                      org.testcontainers/postgresql {:mvn/version "1.21.0"}}
         :jvm-opts ["-Dapi.version=1.44"]
         :main-opts ["-m" "kaocha.runner"]}

  ;; Coverage with test selector support (recommended)
  ;; Uses claij.coverage wrapper which:
  ;; 1. Builds test-ns-regex to exclude integration/long-running test namespaces
  ;; 2. Injects test-selectors for filtering individual tests by metadata
  ;; See dev/claij/coverage.clj for the excluded namespaces list
  :coverage-x {:extra-paths ["dev" "test"]
               :extra-deps {cloverage/cloverage {:mvn/version "1.2.4"}
                            org.testcontainers/testcontainers {:mvn/version "1.21.0"}
                            org.testcontainers/postgresql {:mvn/version "1.21.0"}}
               :exec-fn claij.coverage/run-project
               :exec-args {:src-ns-path ["src"]
                           :test-ns-path ["test"]
                           ;; Exclude SOURCE namespaces that can't load (broken deps, need Python)
                           ;; Test namespace exclusions are handled by claij.coverage/build-test-ns-regex
                           :ns-exclude-regex [;; Can't load - incomplete/broken
                                              "claij\\.agent.*"
                                              "claij\\.core$"
                                              "claij\\.llm\\.grok"
                                              "claij\\.llm\\.gemini"
                                              "claij\\.pipeline.*"
                                              ;; STT source - needs Python
                                              "claij\\.stt\\.core$"
                                              "claij\\.stt\\.handler$"
                                              "claij\\.stt\\.record$"
                                              "claij\\.stt\\.server$"
                                              "claij\\.stt\\.whisper.*"
                                              ;; TTS source - needs Python
                                              "claij\\.tts\\.core$"
                                              "claij\\.tts\\.handler$"
                                              "claij\\.tts\\.playback$"
                                              "claij\\.tts\\.server$"
                                              "claij\\.tts\\.test-playback$"
                                              "claij\\.tts\\.piper.*"]
                           :exclude-call [clojure.tools.logging]}}

  ;; Legacy coverage alias (uses namespace exclusions instead of selectors)
  ;; Consider using :coverage-x instead which uses test metadata selectors
  :coverage {:extra-paths ["test"]
             :extra-deps {cloverage/cloverage {:mvn/version "1.2.4"}
                          org.testcontainers/testcontainers {:mvn/version "1.21.0"}
                          org.testcontainers/postgresql {:mvn/version "1.21.0"}}
             :main-opts ["-m" "cloverage.coverage"
                         "--src-ns-path" "src"
                         "--test-ns-path" "test"
                         ;; Exclude non-test namespaces in test/
                         "--ns-exclude-regex" "claij\\.agent.*"

                         "--ns-exclude-regex" "claij\\.core"
                         ;; Exclude source namespaces with broken dependencies
                         "--ns-exclude-regex" "claij\\.llm\\.grok"
                         "--ns-exclude-regex" "claij\\.llm\\.gemini"
                         "--ns-exclude-regex" "claij\\.pipeline.*"
                         ;; Exclude tests requiring Python/GPU (^:integration)
                         "--ns-exclude-regex" "claij\\.stt.*"
                         "--ns-exclude-regex" "claij\\.tts.*"
                         ;; Exclude integration tests (^:integration)
                         "--ns-exclude-regex" "claij\\.mcp-test"
                         "--ns-exclude-regex" "claij\\.store-test"
                         ;; Exclude long-running tests (^:long-running) - LLM calls
                         "--ns-exclude-regex" "claij\\.poc.*"
                         "--ns-exclude-regex" "claij\\.malli-poc-test"
                         "--ns-exclude-regex" "claij\\.triage-test"
                         "--ns-exclude-regex" "claij\\.fsm\\.minimal-fsm-test"
                         "--exclude-call" "clojure.tools.logging"]}

  :llms {:extra-deps {org.slf4j/slf4j-simple {:mvn/version "2.0.16"}}
         :main-opts ["-m" "claij.server"]}

  :mcp {:extra-paths ["dev"]
        :extra-deps {nrepl/nrepl {:mvn/version "1.5.0"}
                     com.bhauman/clojure-mcp {:mvn/version "0.1.6-SNAPSHOT"
                                              :exclusions [org.slf4j/slf4j-nop]}}
        :main-opts ["-m" "claij.clojure-mcp"]}

  :record {:extra-deps {org.slf4j/slf4j-simple {:mvn/version "2.0.16"}
                        clj-python/libpython-clj {:mvn/version "2.025"}}
           :main-opts ["-m" "claij.stt.record"]}

  :whisper {:extra-deps {org.slf4j/slf4j-simple {:mvn/version "2.0.16"}
                         ;; Python interop - only needed to run STT services
                         clj-python/libpython-clj {:mvn/version "2.025"}}
            :main-opts ["-m" "claij.stt.server"]}

  :piper {:extra-deps {org.slf4j/slf4j-simple {:mvn/version "2.0.16"}
                       ;; Python interop - only needed to run TTS services
                       clj-python/libpython-clj {:mvn/version "2.025"}}
          :main-opts ["-m" "claij.tts.server"]}

  :piper-repl {:extra-deps {org.slf4j/slf4j-simple {:mvn/version "2.0.16"}
                            ;; Python interop - only needed to run TTS services
                            clj-python/libpython-clj {:mvn/version "2.025"}}}

  :build {:deps {io.github.clojure/tools.build {:mvn/version "0.10.5"}}
          :ns-default build}}}
